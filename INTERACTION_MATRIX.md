# 安卓脚本切图神器 - 完整交互模式矩阵

====================================================================================================

## 一、三种模式交互矩阵

| 模式 | Ctrl状态 | 光标 | 左键操作 | 右键操作 |
|------|----------|------|----------|----------|
| **手动框选** (manual) | 松开 | ArrowCursor | 选择ROI，可拖拽移动/调整大小 | 右键菜单 |
| | **按住** | **CrossCursor** | **拖拽框选新ROI，松开后完成创建** | 右键菜单 |
| **超像素合并** (superpixel) | 松开 | ArrowCursor | 选择ROI，可拖拽移动/调整大小 | 右键菜单 |
| | **按住** | **CrossCursor** | **左键点击添加超像素到合并集合** | **右键点击取消选中当前区域** |
| **自动检测** (auto_detect) | 松开 | ArrowCursor | 选择ROI，可拖拽移动/调整大小 | 右键菜单 |
| | **按住** | **CrossCursor** | **点击位置自动检测图标/区域** | **右键取消当前检测预览** |

====================================================================================================

## 二、详细操作流程

### 2.1 手动框选模式 (manual)

```
Ctrl松开状态
    │
    ▼
┌─────────────────┐
│ ArrowCursor     │  ← 普通选择模式
│ 可选择/拖拽ROI  │
└─────────────────┘
    │
    │ 按下Ctrl
    ▼
┌─────────────────┐
│ CrossCursor     │  ← 框选模式
│ 拖拽创建新ROI   │
│ 实时显示虚线框  │
└─────────────────┘
    │
    │ 松开鼠标
    ▼
┌─────────────────┐
│ 创建ROI完成     │
│ 新ROI被选中     │
│ SizeAllCursor   │  ← 可立即拖拽调整
└─────────────────┘
    │
    │ 松开Ctrl（如已松开则保持）
    ▼
    回到选择模式
```

**特点：**
- 按住Ctrl时进入"框选模式"，松开Ctrl回到"选择模式"
- 框选完成后新ROI立即被选中，可直接拖拽调整（无需再次点击）
- 支持连续框选：按住Ctrl不放，可连续创建多个ROI

---

### 2.2 超像素合并模式 (superpixel)

```
Ctrl松开状态
    │
    ▼
┌─────────────────┐
│ ArrowCursor     │  ← 普通选择模式
└─────────────────┘
    │
    │ 按下Ctrl
    ▼
┌─────────────────┐
│ CrossCursor     │  ← 合并模式
│ 左键点击添加    │     黄色高亮已选区域
│ 右键点击取消    │     状态栏显示已选数量
└─────────────────┘
    │
    │ 松开Ctrl
    ▼
┌─────────────────┐
│ 触发合并完成    │  ← 弹出命名对话框
│ 生成不规则ROI   │
└─────────────────┘
```

**特点：**
- 按住Ctrl时进入"合并模式"，显示超像素边界
- 左键点击添加区域到合并集合（黄色高亮）
- 右键点击取消选中某个区域
- 松开Ctrl完成合并，弹出命名对话框

---

### 2.3 自动检测模式 (auto_detect)

```
Ctrl松开状态
    │
    ▼
┌─────────────────┐
│ ArrowCursor     │  ← 普通选择模式
└─────────────────┘
    │
    │ 按下Ctrl
    ▼
┌─────────────────┐
│ CrossCursor     │  ← 检测模式
│ 点击位置检测    │
└─────────────────┘
    │
    │ 点击
    ▼
┌─────────────────┐
│ 显示黄色预览框  │  ← 检测结果显示
│ 可多次点击调整  │
└─────────────────┘
    │
    │ 右键（可选）
    ▼
┌─────────────────┐
│ 取消当前预览    │
└─────────────────┘
    │
    │ 松开Ctrl
    ▼
┌─────────────────┐
│ 确认检测        │  ← 弹出命名对话框
│ 创建ROI         │
└─────────────────┘
```

**特点：**
- 按住Ctrl时进入"检测模式"
- 点击位置进行智能检测，显示黄色虚线预览框
- 可多次点击不同位置选择最佳检测结果
- 右键取消当前预览
- 松开Ctrl确认并弹出命名对话框

====================================================================================================

## 三、通用操作（所有模式）

| 操作 | 触发方式 |
|------|----------|
| 删除选中ROI | Delete键 / 右键菜单"删除选中ROI" |
| 复制ROI | Ctrl+C / 右键菜单"复制ROI" |
| 撤销最后一个ROI | Ctrl+Z / 右键菜单"撤销最后一个ROI" |
| 清空所有ROI | 右键菜单"清空所有ROI" |
| 微调位置 | 方向键(←↑↓→) 移动1px，Shift+方向键 移动10px |
| 切换显示模式 | F键 - 切换1:1显示/适应窗口 |
| 导出切图 | Ctrl+S - 导出PNG和JSON |
| 切换模式 | 顶部工具栏下拉框选择 |

====================================================================================================

## 四、ROI类型与导出行为

| ROI类型 | 导出PNG | JSON字段 | 用途 |
|---------|---------|----------|------|
| **image** | 是 | roi_type, image_name, image_action (detect/detect_and_click) | 图标/图片识别 |
| **region** | 否 | roi_type, action, 动作详细配置 (click/ocr/swipe) | 功能区域 |

### 4.1 image类型详细配置
- **image_action**: detect(仅判断存在) / detect_and_click(判断后点击)
- **导出**: 生成透明PNG图片 + JSON坐标

### 4.2 region类型详细配置

| action | 附加字段 | 说明 |
|--------|----------|------|
| click | click_mode, click_count, click_interval | 单次/循环点击 |
| ocr | (无) | 文字识别区域 |
| swipe | swipe_direction, swipe_speed | 滑动操作 |

====================================================================================================

## 五、光标状态说明

| 光标 | 状态 | 含义 |
|------|------|------|
| ArrowCursor | 默认 | 普通选择状态 |
| CrossCursor | Ctrl按下 | 进入特殊操作模式（框选/合并/检测） |
| SizeAllCursor | 在ROI上 | 可拖拽移动ROI |
| SizeHorCursor | 左右手柄 | 可水平调整大小 |
| SizeVerCursor | 上下手柄 | 可垂直调整大小 |
| SizeFDiagCursor | 左上/右下手柄 | 可沿对角线调整大小 |
| SizeBDiagCursor | 右上/左下手柄 | 可沿反对角线调整大小 |

====================================================================================================

## 六、关键交互原则

1. **Ctrl键统一控制**: 所有三种模式都使用Ctrl键切换"操作模式"和"选择模式"
2. **松手即完成**: 超像素和自动检测模式下，松开Ctrl即触发完成信号
3. **即时编辑**: 手动框选完成后新ROI立即被选中，可直接拖拽调整
4. **光标反馈**: 光标形状始终反映当前可操作状态
5. **右键菜单**: 非特殊模式下右键统一弹出操作菜单

====================================================================================================
